name: Selenium CI

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  selenium-tests:
    runs-on: ubuntu-latest

    steps:
    # 1. Checkout the code
    - name: Checkout repository
      uses: actions/checkout@v3

    # 2. Set up Chrome
    - name: Setup Chrome
      uses: browser-actions/setup-chrome@v1
      with:
        chrome-version: latest

    # 3. Set up ChromeDriver
    - name: Setup ChromeDriver
      uses: nanasess/setup-chromedriver@v1
      with:
        chromedriver-version: latest

    # 4. Install dependencies (Xvfb for virtual display, ffmpeg for recording)
    - name: Install dependencies
      run: sudo apt-get update && sudo apt-get install -y xvfb ffmpeg libnss3 libgconf-2-4

    # 5. Start virtual display
    - name: Start virtual display
      run: Xvfb :99 -screen 0 1920x1080x24 &
      env:
        DISPLAY: :99

    # 6. Start screen recording
    - name: Start screen recording
      run: ffmpeg -video_size 1920x1080 -framerate 25 -f x11grab -i :99 -y target/video/test.mp4 &
      env:
        DISPLAY: :99

    # 7. Run Maven Selenium tests
    - name: Run Selenium tests
      run: mvn test
      env:
        DISPLAY: :99

    # 8. Upload recorded video
    - name: Upload Selenium test video
      uses: actions/upload-artifact@v3
      with:
        name: selenium-test-video
        path: target/video/test.mp4
